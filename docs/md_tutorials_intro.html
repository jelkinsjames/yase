<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YASE: Tutorial: Yase Basics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<script>
    function delay(time) {
       return new Promise(resolve => setTimeout(resolve, time));
    }
    window.onload = function() {
      var el = document.getElementsByClassName('title');
      if ( el[0].innerText == 'YASE') {
          el[0].innerText = 'Yet Another Synthesizer Engine';
          el[0].style.cssText += "";
          delay(100).then(() => {
            var els = document.getElementsByClassName('item');
            els[1].children[0].click();
            delay(100).then(() => {
                els = document.getElementsByClassName('item');
                els[2].children[0].click();
                delay(100).then(() => {
                    els = document.getElementsByClassName('item');
                    els[3].children[0].click();
                });
            });
          });
      }
    }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="yase-logo.png"/></td>
 </tr>
 <tr>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">Yet Another Synthesizer Engine</div>
  </td>
  </tr>
  <tr>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_tutorials_intro.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial: Yase Basics </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md24"></a>
A Sawtooth Wave</h1>
<p >In this tutorial, we will synthesize a patch to illustrate several basic features of yase including oscillators, filters, envelopes, and ani-aliasing. We will build up complexity incrementally starting from a sawtooth wave. Our starting point is to include the Yase library, open the <em>yase</em> namespace (so we do not have to prepend Yase class names with yase::), and write a <em>main</em> function that does nothing for now.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;yase.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>yase;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[]) {</div>
<div class="line">    <span class="keywordflow">return</span> 0; </div>
<div class="line">}</div>
</div><!-- fragment --><p >At this point you should be able to compile and run the above code, but it will not do anything. Next we will fill in the <em>main</em> function. Many Yase main functions are divided into three into three sections: declarations, setup, and execution, which we describe in turn.</p>
<p ><b>Declarations:</b> First, we declare three Modules that are enough to give us a basic sound.</p>
<div class="fragment"><div class="line">Container synth;</div>
<div class="line">Audio audio;</div>
<div class="line">Saw saw(<span class="stringliteral">&quot;raw&quot;</span>);</div>
</div><!-- fragment --><p >The first is a <a href="classyase_1_1_container.html">Container</a> into which we will put all other syntheiszer components. The second is an <a href="classyase_1_1_audio.html">Audio</a> module that interfaces with your computer's audio card to produce sound. The third is a <a href="classyase_1_1_saw.html">Sawtooth</a> waveform module. The "raw" argument to the <em>Saw</em> constructor tells yase to return a digital sawtooth wave that simply increases linearly up to a certain point and then resets. Students of digital signal processing will know that such a waveform, when sampled, will produce unwanted frequencies due to aliasing. We'll fix that soon.</p>
<p ><b>Setup</b>: Next we connect the output of the sawtooth module to the two inputs of the audio module.</p>
<div class="fragment"><div class="line">synth.connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;left&quot;</span>)</div>
<div class="line">     .connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;right&quot;</span>);</div>
</div><!-- fragment --><p >Specifcally, these connect the "signal" output of the <em>saw</em> module to the "left" and "right" inputs of the <em>audio</em> module. Later, each time the <em>synth</em> module is updated, it will first copy the output of the <em>saw</em> module to the inputs of the audio module, and then call the update methods of the <em>saw</em> and <em>audio</em> modules. Note the we are using the strings "signal", "left", and "right" to refer to the inputs and outpus of these modules. That may seem ill-advised in what is supposed to be fast C++ code, since string methods are typically slow. But they are only used in the setup phase. Internally, Yase translates these names to integer indices that are used during execution, so everything is as fast as can be.</p>
<p >Note: Many <em>Container</em> methods, like <em>connect</em> return a reference to the container so that you can "method chain". The above is the same as writing</p>
<div class="fragment"><div class="line">synth.connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;left&quot;</span>);</div>
<div class="line">synth.connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;right&quot;</span>);</div>
</div><!-- fragment --><p >but slightly more compact. Not having to see <em>synth</em> over and over again will looke nicer when we start connecting dozens of modules.</p>
<p ><b>Execution</b>: Finally, we need a <em>run</em> statement.</p>
<div class="fragment"><div class="line">synth.run(<a class="code hl_define" href="globals_8hh.html#a6949631d06a570d1c3f014ac82285d47">UNTIL_INTERRUPTED</a>);</div>
<div class="ttc" id="aglobals_8hh_html_a6949631d06a570d1c3f014ac82285d47"><div class="ttname"><a href="globals_8hh.html#a6949631d06a570d1c3f014ac82285d47">UNTIL_INTERRUPTED</a></div><div class="ttdeci">#define UNTIL_INTERRUPTED</div><div class="ttdoc">Use as in Synthesizer::run(UNTIL_INTERUPTED)</div><div class="ttdef"><b>Definition:</b> globals.hh:27</div></div>
</div><!-- fragment --><p >It tells the <em>synth</em> module to start updating (at the default frequency of 44100 Hz).</p>
<p >The entire program now looks like this:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;yase.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>yase;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[]) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Declare</span></div>
<div class="line">    Container synth;</div>
<div class="line">    Audio audio;</div>
<div class="line">    Saw saw(<span class="stringliteral">&quot;raw&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup</span></div>
<div class="line">    synth.connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;left&quot;</span>)</div>
<div class="line">         .connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;right&quot;</span>);  </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Execute</span></div>
<div class="line">    synth.run(<a class="code hl_define" href="globals_8hh.html#a6949631d06a570d1c3f014ac82285d47">UNTIL_INTERRUPTED</a>);   </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Cleanup</span></div>
<div class="line">    <span class="keywordflow">return</span> 0; </div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p >Compiling and running this example will produce a somewhat annoying, sawtooth wave at 440 Hz (the default). You can stop it by pressing Cntl-C. Pressing Cntl-C will pop out of the <em>run</em> method, so that any clean up code can execute. Here we simply return 0 to the OS and exit.</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Defining a Melody</h1>
<p >It is hard to evaluate a patch out of context, that is, outside of a melody or harmony. With Yase you can supply a melody in various ways, for example by connecting an external sequencer via MIDI. But for our purposes, it will be much simpler and still ullustrative to use a <a href="classyase_1_1_player.html">Player</a> Module. In the declarations section of the main function, we write:</p>
<div class="fragment"><div class="line">Player player;</div>
</div><!-- fragment --><p >and then we add it to the <em>synth</em> container. Our <em>connect</em> statement becomes</p>
<div class="fragment"><div class="line">synth.connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;left&quot;</span>)</div>
<div class="line">     .connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;right&quot;</span>)</div>
<div class="line">     .add(player);</div>
</div><!-- fragment --><p >Note that all modules contained within <em>synth</em> need to be added. However, the <em>saw</em> and <em>audio</em> modules are added implicitly by connecting them within the <em>synth</em> module. The <em>player</em> module on the other hand does not directly use signals, so we have add it to the <em>synth</em> module explicitly so that it's update method is called.</p>
<p >Now we need to define the behavior of the player. We can do that with the <em>set</em> method to the player as follows.</p>
<div class="fragment"><div class="line">player.set({ G3, C4, A3, F4, F2, F1 }, [&amp;] (<span class="keywordtype">double</span> freq) {</div>
<div class="line">    saw.set_input(<span class="stringliteral">&quot;frequency&quot;</span>, freq);</div>
<div class="line">}, 3.0);</div>
</div><!-- fragment --><p >The <em>set</em> method takes three arguments. The first is a vector of frequencies. Here, we are using Yase's names for notes, like <em>yase::G3</em> which we can just write as G3 since we have the yase name space open. The third argument is the duration of each note in seconds. And the second argument is a callback method that defines what to do each time the note changes. This argument is a C++ <em>lambda</em>, which is a way of specifying a function without naming it. The player will call the callback every three seconds cycling through the frequencies. You can see in the body of the callback the single line that changes the frequency of the sawtooth wave. The entire program is now</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;yase.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>yase;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[]) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Declare</span></div>
<div class="line">    Container synth;</div>
<div class="line">    Audio audio;</div>
<div class="line">    Saw saw(<span class="stringliteral">&quot;raw&quot;</span>);</div>
<div class="line">    Player player;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup</span></div>
<div class="line">    synth.connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;left&quot;</span>)</div>
<div class="line">         .connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;right&quot;</span>)</div>
<div class="line">         .add(player);</div>
<div class="line"> </div>
<div class="line">    player.set({ G3, C4, A3, F4, F2, F1 }, [&amp;] (<span class="keywordtype">double</span> freq) {</div>
<div class="line">        saw.set_input(<span class="stringliteral">&quot;frequency&quot;</span>, freq);</div>
<div class="line">    }, 3.0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Execute</span></div>
<div class="line">    synth.run(<a class="code hl_define" href="globals_8hh.html#a6949631d06a570d1c3f014ac82285d47">UNTIL_INTERRUPTED</a>);   </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Cleanup</span></div>
<div class="line">    <span class="keywordflow">return</span> 0; </div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p >Compiling and running the resulting code should now play the melody over and over again &mdash; using our annoying sawtooth wave &mdash; until you press Cntl-C. Try it!</p>
<h1><a class="anchor" id="autotoc_md26"></a>
Anti-Aliasing</h1>
<p >The raw sawtooth waveform we are using does not sound great. One reason is that sampling it at 44100 Hz produces artifacts due to aliasing. These can be heard as a faint buzz. There are a variety of ways to fix this in Yase. One is to build the sawtooth wave from sine waves. Another is to soften the waveform. These each have their pros and cons. Here, we'll wrap an <a href="classyase_1_1_anti_alias.html">AntiAlias</a> module around the sawtooth module. It samples the sawtooth at twice the normal sample rate, so 88200 Hz, and then applies a low pass filter to cutt off frequencies lower than 22050 Hz. The module then downsamples back to 44100 Hz. Thus, frequencies that would have reflected off of the 22050 Nyquist sampling rate to produce a buzz are now significantly attenuated. The result is a noticable improvement. Using this module is a sample as replacing the <em>saw</em> declartion with</p>
<div class="fragment"><div class="line">Saw raw(<span class="stringliteral">&quot;raw&quot;</span>);</div>
<div class="line">AntiAlias saw(raw);</div>
</div><!-- fragment --><p >Nothing else needs to change. Compiling and running this code produces a slightly less annoying sawtooth wave. But it is still a basic sawtooth wave, which not everyone likes.</p>
<h1><a class="anchor" id="autotoc_md27"></a>
Adding an Envelope</h1>
<p >One reason the sound of the sawtooth is annoying is that it abrubtly starts and abruptly changes when a new note is played. Musical instruments don't do that. Notes start slowly or quickly, but not instantly. And they decay to a sustained level and ring a bit after they are released. In audio synthesis, this is accomplished with an <a href="classyase_1_1_envelope.html">Envelope</a>, which sets an attack, decay, and release time as well as a sustain level. To add an envelope, we declare one:</p>
<div class="fragment"><div class="line">Envelope envelope;</div>
</div><!-- fragment --><p >and set its attack, decay, sustain, and release parameters, also known as the ADSR of the envelope, in the setup phase:</p>
<div class="fragment"><div class="line">envelope.set_adsr(0.8, 1.0, 0.5, 0.1);</div>
</div><!-- fragment --><p >The attack of the standard envelope in Yase is linear, so 0.8 means it will take 0.8 s to get to maximum output. The decay and release are exponential. The 1.0 and 0.1 parameters mean it will take 1.0 s and 0.1 s to get to 90% decayed or released. The 0.5 is the sustain level. The note will decay to 50% volume expoentially.</p>
<p >Next, we have to connect the envelope to the amplitude of the sawtooth, which we do in the setup phase with the statement:</p>
<div class="fragment"><div class="line">synth.connect(envelope, <span class="stringliteral">&quot;signal&quot;</span>, saw, <span class="stringliteral">&quot;amplitude&quot;</span>);</div>
</div><!-- fragment --><p >And finally, we need to make sure the envelope starts over every time we begin a new note with the <em>player</em>. This can be done using the <em>trigger</em> method of the <em>Envelope</em> class:</p>
<div class="fragment"><div class="line">player.set({ G3, C4, A3, F4, F2, F1 }, [&amp;] (<span class="keywordtype">double</span> freq) {</div>
<div class="line">    saw.set_input(<span class="stringliteral">&quot;frequency&quot;</span>, freq);</div>
<div class="line">    envelope.trigger();</div>
<div class="line">}, 3.0);</div>
</div><!-- fragment --><p >The entire example is now</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;yase.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>yase;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[]) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Declare</span></div>
<div class="line">    Container synth;</div>
<div class="line">    Audio audio;</div>
<div class="line">    Saw saw(<span class="stringliteral">&quot;raw&quot;</span>);</div>
<div class="line">    Player player;</div>
<div class="line">    Envelope envelope;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup</span></div>
<div class="line">    synth.connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;left&quot;</span>)</div>
<div class="line">         .connect(saw, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;right&quot;</span>)</div>
<div class="line">         .connect(envelope, <span class="stringliteral">&quot;signal&quot;</span>, saw, <span class="stringliteral">&quot;amplitude&quot;</span>)</div>
<div class="line">         .add(player);</div>
<div class="line"> </div>
<div class="line">    player.set({ G3, C4, A3, F4, F2, F1 }, [&amp;] (<span class="keywordtype">double</span> freq) {</div>
<div class="line">        saw.set_input(<span class="stringliteral">&quot;frequency&quot;</span>, freq);</div>
<div class="line">        envelope.trigger();</div>
<div class="line">    }, 3.0);</div>
<div class="line"> </div>
<div class="line">    envelope.set_adsr(0.8, 1.0, 0.5, 0.1);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Execute</span></div>
<div class="line">    synth.run(<a class="code hl_define" href="globals_8hh.html#a6949631d06a570d1c3f014ac82285d47">UNTIL_INTERRUPTED</a>);   </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Cleanup</span></div>
<div class="line">    <span class="keywordflow">return</span> 0; </div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p >Now when you compile and run, your ears won't be nearly as offended. Although we can continue to refine this patch.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Adding a Filter</h1>
<p >To mellow out the sound of the sawtooth wave, we can filter out some of the high frequencies using a low pass filter. A standard choice is the <a href="classyase_1_1_biquad.html">Biquad</a> filter, which is a second order IIR filter with an easily tunable resonance and cutoff. We declare a Biquad filter like this:</p>
<div class="fragment"><div class="line">Biquad filter;</div>
</div><!-- fragment --><p >By default, this filter is a low pass filter, but you can use the <em>Biquad::set_type</em> method to change it to a high pass, band pass, or all pass filter.</p>
<p >Next, we insert the filter into the <em>synth</em> container after the sawtooth and before the audio module.</p>
<div class="fragment"><div class="line">synth.connect(saw,filter)</div>
<div class="line">     .connect(filter, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;left&quot;</span>)</div>
<div class="line">     .connect(filter, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;right&quot;</span>)</div>
<div class="line">     .connect(envelope, <span class="stringliteral">&quot;signal&quot;</span>, saw, <span class="stringliteral">&quot;amplitude&quot;</span>)</div>
<div class="line">     .add(player);</div>
</div><!-- fragment --><p >Note that the two argument version of the <em>connect</em> method assumes the names of the inputs and outputs are "signal". This just makes the code a bit easier to read.</p>
<p >Next, we can set the resonance and cutoff frequency of the filter in the set up secction:</p>
<div class="fragment"><div class="line">filter.set_input(<span class="stringliteral">&quot;resonance&quot;</span>, 10);</div>
<div class="line">filter.set_input(<span class="stringliteral">&quot;frequency&quot;</span>, 2000);</div>
</div><!-- fragment --><p >Try different resonances and frequencies for the filter. Be careful with high resonances because the filter can self-oscillate, which is hard on the ears.</p>
<p >The entire program now looks like this:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;yase.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>yase;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[]) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Declare</span></div>
<div class="line">    Container synth;</div>
<div class="line">    Audio audio;</div>
<div class="line">    Saw saw(<span class="stringliteral">&quot;raw&quot;</span>);</div>
<div class="line">    Player player;</div>
<div class="line">    Envelope envelope;</div>
<div class="line">    Biquad filter;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup</span></div>
<div class="line">    synth.connect(saw,filter)</div>
<div class="line">         .connect(filter, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;left&quot;</span>)</div>
<div class="line">         .connect(filter, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;right&quot;</span>)</div>
<div class="line">         .connect(envelope, <span class="stringliteral">&quot;signal&quot;</span>, saw, <span class="stringliteral">&quot;amplitude&quot;</span>)</div>
<div class="line">         .add(player);</div>
<div class="line"> </div>
<div class="line">    player.set({ G3, C4, A3, F4, F2, F1 }, [&amp;] (<span class="keywordtype">double</span> freq) {</div>
<div class="line">        saw.set_input(<span class="stringliteral">&quot;frequency&quot;</span>, freq);</div>
<div class="line">        envelope.trigger();</div>
<div class="line">    }, 3.0);</div>
<div class="line"> </div>
<div class="line">    envelope.set_adsr(0.8, 1.0, 0.5, 0.1);</div>
<div class="line"> </div>
<div class="line">    filter.set_input(<span class="stringliteral">&quot;resonance&quot;</span>, 10);</div>
<div class="line">    filter.set_input(<span class="stringliteral">&quot;frequency&quot;</span>, 2000);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Execute</span></div>
<div class="line">    synth.run(<a class="code hl_define" href="globals_8hh.html#a6949631d06a570d1c3f014ac82285d47">UNTIL_INTERRUPTED</a>);   </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Cleanup</span></div>
<div class="line">    <span class="keywordflow">return</span> 0; </div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md29"></a>
A Filter Envelope</h1>
<p >Just like an envelope can modulate a sound's amplitude over time, an envelope can also modulate a filter's parameters over time. This makes a much more interesting sound than a constant filter. For example, the "wah" sound of a wah-wah pedal comes from modulating a low pass filter's cuttoff frequency from low to high as a note is played.</p>
<p >To accomplish this, let's use another envelope. So that we don't get our two filters confused, we'll change the name of our existing envelop as well.</p>
<div class="fragment"><div class="line">Envelope wave_envelope, filter_envelope;</div>
</div><!-- fragment --><p >We would like to connect the "signal" output of the <em>filter_envelope</em> to the "frequency" input of the filter. But the envelope's output ranges from 0 to 1, while an interesting cutoff frequency would range from something like 500 Hz to 4000 Hz. Thus, we need to transform the output of the <em>filter_envelope</em> to that range. We can do this with a <a href="classyase_1_1_transform.html">Transform</a> module, which we declare as follows:</p>
<div class="fragment"><div class="line">Transform scale( [] (<span class="keywordtype">double</span> u) { <span class="keywordflow">return</span> 500 + 4000*u; });</div>
</div><!-- fragment --><p >The constructor to <em>Transform</em> takes a function, which we specify here using a C++ lambda expression. The lambda takes an argument u, which is the input to the transform, and returns a scaled and shifted value, which will be the output to the transform. We can then connect the transform, filter_envelope, and filter like this:</p>
<div class="fragment"><div class="line">synth.connect(filter_envelope, scale)</div>
<div class="line">     .connect(scale, <span class="stringliteral">&quot;signal&quot;</span>, filter, <span class="stringliteral">&quot;frequency&quot;</span>);</div>
</div><!-- fragment --><p >Each time a new note is played, we need to re-trigger both envelopes, which we do like this:</p>
<div class="fragment"><div class="line">player.set({ G3, C4, A3, F4, F2, F1 }, [&amp;] (<span class="keywordtype">double</span> freq) {</div>
<div class="line">    saw.set_input(<span class="stringliteral">&quot;frequency&quot;</span>, freq);</div>
<div class="line">    wave_envelope.trigger();</div>
<div class="line">    filter_envelope.trigger();</div>
<div class="line">}, 3.0);</div>
</div><!-- fragment --><p >Then we'll just set up the parameters of the filter envelope, using slightly different values than the wave envelope for a nice effect.</p>
<div class="fragment"><div class="line">filter_envelope.set_adsr(2.0, 2.0, 0.0, 0.1); </div>
</div><!-- fragment --><p >Now our program looks like this:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;yase.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>yase;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[]) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Declare</span></div>
<div class="line">    Container synth;</div>
<div class="line">    Audio audio;</div>
<div class="line">    Saw saw(<span class="stringliteral">&quot;raw&quot;</span>);</div>
<div class="line">    Player player;</div>
<div class="line">    Envelope wave_envelope, filter_envelope;</div>
<div class="line">    Transform scale( [] (<span class="keywordtype">double</span> u) { <span class="keywordflow">return</span> 500 + 4000*u; });</div>
<div class="line">    Biquad filter;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup</span></div>
<div class="line">    synth.connect(saw,filter)</div>
<div class="line">         .connect(filter, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;left&quot;</span>)</div>
<div class="line">         .connect(filter, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;right&quot;</span>)</div>
<div class="line">         .connect(wave_envelope, <span class="stringliteral">&quot;signal&quot;</span>, saw, <span class="stringliteral">&quot;amplitude&quot;</span>)</div>
<div class="line">         .connect(filter_envelope, scale)</div>
<div class="line">         .connect(scale, <span class="stringliteral">&quot;signal&quot;</span>, filter, <span class="stringliteral">&quot;frequency&quot;</span>)</div>
<div class="line">         .add(player);</div>
<div class="line"> </div>
<div class="line">    player.set({ G3, C4, A3, F4, F2, F1 }, [&amp;] (<span class="keywordtype">double</span> freq) {</div>
<div class="line">        saw.set_input(<span class="stringliteral">&quot;frequency&quot;</span>, freq);</div>
<div class="line">        wave_envelope.trigger();</div>
<div class="line">        filter_envelope.trigger();</div>
<div class="line">    }, 3.0);</div>
<div class="line"> </div>
<div class="line">    wave_envelope.set_adsr(0.8, 1.0, 0.5, 0.1);</div>
<div class="line">    filter_envelope.set_adsr(2.0, 2.0, 0.0, 0.1);  </div>
<div class="line"> </div>
<div class="line">    filter.set_input(<span class="stringliteral">&quot;resonance&quot;</span>, 10);</div>
<div class="line">    filter.set_input(<span class="stringliteral">&quot;frequency&quot;</span>, 2000);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Execute</span></div>
<div class="line">    synth.run(<a class="code hl_define" href="globals_8hh.html#a6949631d06a570d1c3f014ac82285d47">UNTIL_INTERRUPTED</a>);   </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Cleanup</span></div>
<div class="line">    <span class="keywordflow">return</span> 0; </div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md30"></a>
Adding an Echo Effect</h1>
<p >Finally, we'll take our patch to an entirely new level by adding an <a href="classyase_1_1_echo.html">Echo</a>. This will introduce significantly more texture to the patch. One thing that will happen is that many attenuated copies of our original sound will be added to each other. The result is interesting, but also a lot louder. So we'll also want to attenuate the total sound, which we'll do by adding a volume <a href="classyase_1_1_gain.html">Gain</a>. We can also get a cute stereo effect by sending the output of the echo to the left channel, and an inverted copy of the output to the right channel.</p>
<p >We declare these modules like this:</p>
<div class="fragment"><div class="line">Echo echo;</div>
<div class="line">Gain gain;</div>
<div class="line">Transform invert( [] (<span class="keywordtype">double</span> u) { <span class="keywordflow">return</span> -u; });</div>
</div><!-- fragment --><p >set up the gain like this: </p><div class="fragment"><div class="line">gain.set_input(<span class="stringliteral">&quot;amplitude&quot;</span>, 0.35);</div>
</div><!-- fragment --><p >and connect them like this:</p>
<div class="fragment"><div class="line">synth.path(saw, filter, echo, gain, invert)</div>
<div class="line">     .connect(gain, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;left&quot;</span>)</div>
<div class="line">     .connect(invert, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;right&quot;</span>);</div>
</div><!-- fragment --><p >Then we set the paramters of the echo effect. The "duration" of the echo is an integer number of samples to store in the echo's delay buffer. For a 0.5 s delay, we use SAMPLE_RATE / 2 = 22050 samples:</p>
<div class="fragment"><div class="line">echo.set_input(<span class="stringliteral">&quot;duration&quot;</span>, <a class="code hl_define" href="globals_8hh.html#a4b76a0c2859cfd819a343a780070ee2b">SAMPLE_RATE</a>/2);</div>
<div class="ttc" id="aglobals_8hh_html_a4b76a0c2859cfd819a343a780070ee2b"><div class="ttname"><a href="globals_8hh.html#a4b76a0c2859cfd819a343a780070ee2b">SAMPLE_RATE</a></div><div class="ttdeci">#define SAMPLE_RATE</div><div class="ttdoc">The sample rate of everything in yase.</div><div class="ttdef"><b>Definition:</b> globals.hh:32</div></div>
</div><!-- fragment --><p >We also need the amount of signal to feed back into the system. Choosing 80% sounds good:</p>
<div class="fragment"><div class="line">echo.set_input(<span class="stringliteral">&quot;amplitude&quot;</span>, 0.8);</div>
</div><!-- fragment --><p >The final program is now:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;yase.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>yase;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[]) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Declare</span></div>
<div class="line">    Container synth;</div>
<div class="line">    Audio audio;</div>
<div class="line">    Biquad filter;</div>
<div class="line">    Saw raw(<span class="stringliteral">&quot;raw&quot;</span>);</div>
<div class="line">    AntiAlias saw(raw);</div>
<div class="line">    Envelope wave_envelope, filter_envelope;</div>
<div class="line">    Player player;</div>
<div class="line">    Transform scale( [] (<span class="keywordtype">double</span> u) { <span class="keywordflow">return</span> 500 + 4000*u; }),</div>
<div class="line">              invert( [] (<span class="keywordtype">double</span> u) { <span class="keywordflow">return</span> -u; });</div>
<div class="line">    Echo echo;</div>
<div class="line">    Gain gain;      </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup</span></div>
<div class="line">    synth.path(saw, filter, gain, echo, invert)</div>
<div class="line">         .connect(echo, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;left&quot;</span>)</div>
<div class="line">         .connect(invert, <span class="stringliteral">&quot;signal&quot;</span>, audio, <span class="stringliteral">&quot;right&quot;</span>)</div>
<div class="line">         .connect(wave_envelope, <span class="stringliteral">&quot;signal&quot;</span>, saw, <span class="stringliteral">&quot;amplitude&quot;</span>)</div>
<div class="line">         .connect(filter_envelope, scale)</div>
<div class="line">         .connect(scale, <span class="stringliteral">&quot;signal&quot;</span>, filter, <span class="stringliteral">&quot;frequency&quot;</span>)</div>
<div class="line">         .add(player);</div>
<div class="line"> </div>
<div class="line">    player.set({ G3, C4, A3, F4, F2, F1 }, [&amp;] (<span class="keywordtype">double</span> freq) {</div>
<div class="line">      saw.set_input(<span class="stringliteral">&quot;frequency&quot;</span>, freq);</div>
<div class="line">      wave_envelope.trigger();</div>
<div class="line">      filter_envelope.trigger();</div>
<div class="line">    }, 3.0);</div>
<div class="line"> </div>
<div class="line">    saw.set_input(<span class="stringliteral">&quot;amplitude&quot;</span>, 0.4);</div>
<div class="line">    filter.set_input(<span class="stringliteral">&quot;resonance&quot;</span>, 10);</div>
<div class="line">    gain.set_input(<span class="stringliteral">&quot;amplitude&quot;</span>, 0.35);</div>
<div class="line">    echo.set_input(<span class="stringliteral">&quot;duration&quot;</span>, <a class="code hl_define" href="globals_8hh.html#a4b76a0c2859cfd819a343a780070ee2b">SAMPLE_RATE</a>/2);</div>
<div class="line">    echo.set_input(<span class="stringliteral">&quot;amplitude&quot;</span>, 0.8);</div>
<div class="line">    wave_envelope.set_adsr(0.8, 1.0, 0.5, 0.1);</div>
<div class="line">    filter_envelope.set_adsr(2.0, 2.0, 0.0, 0.1);      </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Execute</span></div>
<div class="line">    synth.run(<a class="code hl_define" href="globals_8hh.html#a6949631d06a570d1c3f014ac82285d47">UNTIL_INTERRUPTED</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Cleanup</span></div>
<div class="line">    <span class="keywordflow">return</span> 0; </div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p >Compile and run this program and you will hear a pretty cool sound!</p>
<h1><a class="anchor" id="autotoc_md31"></a>
Next Steps</h1>
<p >As you can see, building a patch in Yase is fairly straightforward. You declare some modules, connect them together, set their parameters, and run. Try building on this example. Here are some ideas:</p><ul>
<li>Try changing the attack, sustain, decay, and release parameters, the duration of the player's steps, the duration of the echo, and the amount of the echo to see how these parameters affect the sound.</li>
<li>Try using a <a href="classyase_1_1_square.html">Square</a> wave instead of a sawtooth wave.</li>
<li>Try using a <a href="classyase_1_1_noise.html">Noise</a> source instead of a sawtooth wave.</li>
<li>Tye using a high pass filter instead of a low pass filter. You might want to modify the offset and range of the cuttoff frequency in the <em>scale</em> transform to get pleasing sound. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
      <li class="footer">YASE was developed by and is maintained by <a href="http://klavinslab.org">Eric Klavins</a>
    </ul>
  </div>
  </body>
  </html>