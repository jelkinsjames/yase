<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YASE: Controls/controls.cc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">YASE
   </div>
   <div id="projectbrief">Yet Another Synthesizer Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_controls_2controls_8cc-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Controls/controls.cc</div></div>
</div><!--header-->
<div class="contents">
<p >Use a Controls object to connect MIDI knobs and faders to Module inputs. For example, to add a volume knob to your project, you can do</p>
<div class="fragment"><div class="line">Container synth;</div>
<div class="line">Gain gain;</div>
<div class="line">Controls controls;</div>
<div class="line">MidiInput midi(<span class="stringliteral">&quot;Your Device&quot;</span>);</div>
<div class="line"> </div>
<div class="line">synth.add(gain)</div>
<div class="line">     .add(conrols)</div>
<div class="line">     .add(midi)</div>
<div class="line">     .propagate_to(controls); <span class="comment">// Important!</span></div>
<div class="line"> </div>
<div class="line">              <span class="comment">// module, input name,  min, max, midi id                  </span></div>
<div class="line">controls.control(gain,   <span class="stringliteral">&quot;amplitude&quot;</span>, 0,   1,   123);</div>
</div><!-- fragment --><p >Note that a controls object is a Container, just like the synth Container above. Thus, it can receive events from the MidiInput object. However, you must explicitly tell the synth container to propagate events to the controls container.</p>
<p >Using the example above, you can now turn the knob on your controller with MIDI id 123 and modulate the amlitude of the gain module. The controls object maps the MIDI value, which ranges from 0 to 127, to the interval [0,1]. By default, this mapping is linear. But you can make it exponential if you want more sensititvy at the low end. For example,</p>
<div class="fragment"><div class="line">controls.control(gain, <span class="stringliteral">&quot;amplitude&quot;</span>, 0, 1, 123)</div>
<div class="line">        .exponential(1e4);</div>
</div><!-- fragment --><p >Here, the mapping between the MIDI knob position and the amplitude will follow</p>
<p >\(\frac{(y-x)b^{m/127-1}}{b-1}+x\)</p>
<p >where x and y are the minimum and maximum value of the control, b is the base of the exponential (1e4 in this example), and m is the MIDI value.</p>
<p >This is easy to see graphically. In the image below, the control output ranges from 2.0 to 5.0 and the response to the MIDI input is shown for various bases.</p>
<div class="image">
<img src="exponential-controls.png" alt=""/>
</div>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ncurses.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;yase.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>yase;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> SIZE=20;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">string</span> device_name = <span class="stringliteral">&quot;Arturia MiniLab mkII&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> midi_ids[4] = { 74, 71, 18, 19 };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Report : <span class="keyword">public</span> Module {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">  Report() {</div>
<div class="line">       <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;4; i++ ) {</div>
<div class="line">         add_input(<span class="stringliteral">&quot;signal_&quot;</span> + to_string(i));</div>
<div class="line">       }</div>
<div class="line">       buf[SIZE-1] = 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> init() {</div>
<div class="line">       count = 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> update() {</div>
<div class="line">       <span class="keywordflow">if</span> ( count++ &gt; 1000 ) {</div>
<div class="line">            count = 0;</div>
<div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;4; i++ ) {</div>
<div class="line">               u = inputs[i];</div>
<div class="line">               <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt;SIZE-1; j++ ) {</div>
<div class="line">                    buf[j] = j &lt; (int) u ? <span class="charliteral">&#39;*&#39;</span> : <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">               }</div>
<div class="line">               mvprintw(3*(i/2)+1, 2 + (SIZE+5) * (i%2), <span class="stringliteral">&quot;Knob %d: %0.2f&quot;</span>, i, u);</div>
<div class="line">               mvprintw(3*(i/2)+2, 2 + (SIZE+5) * (i%2), <span class="stringliteral">&quot;[%s]&quot;</span>, buf);</div>
<div class="line"> </div>
<div class="line">            }            </div>
<div class="line">            refresh();</div>
<div class="line">       }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> signal;</div>
<div class="line">  <span class="keywordtype">char</span> buf[SIZE];</div>
<div class="line">  <span class="keywordtype">double</span> u;</div>
<div class="line">  <span class="keywordtype">int</span> count;</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[]) {</div>
<div class="line"> </div>
<div class="line">    Container synth;</div>
<div class="line">    Controls controls;</div>
<div class="line">    Audio audio; <span class="comment">// There is no sound, but the audio module regulates timing</span></div>
<div class="line">    Report report;</div>
<div class="line">    MidiInput midi(device_name);</div>
<div class="line"> </div>
<div class="line">    synth.add(audio)</div>
<div class="line">         .add(midi)</div>
<div class="line">         .add(controls)</div>
<div class="line">         .propagate_to(controls);</div>
<div class="line"> </div>
<div class="line">    controls.control(report, 0, 0, SIZE, midi_ids[0]).linear();</div>
<div class="line">    controls.control(report, 1, 0, SIZE, midi_ids[1]).exponential(1e-2);</div>
<div class="line">    controls.control(report, 2, 0, SIZE, midi_ids[2]).exponential(1e2);</div>
<div class="line">    controls.control(report, 3, 0, SIZE, midi_ids[3]).exponential(1e5);</div>
<div class="line"> </div>
<div class="line">    initscr();    </div>
<div class="line">    curs_set(0);</div>
<div class="line">    synth.run(<a id="a0" name="a0"></a><a class="code hl_define" href="globals_8hh.html#a6949631d06a570d1c3f014ac82285d47">UNTIL_INTERRUPTED</a>);</div>
<div class="line">    endwin();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="aglobals_8hh_html_a6949631d06a570d1c3f014ac82285d47"><div class="ttname"><a href="globals_8hh.html#a6949631d06a570d1c3f014ac82285d47">UNTIL_INTERRUPTED</a></div><div class="ttdeci">#define UNTIL_INTERRUPTED</div><div class="ttdoc">Use as in Synthesizer::run(UNTIL_INTERUPTED)</div><div class="ttdef"><b>Definition:</b> globals.hh:7</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
      <li class="footer">Generated by
      <a href="http://www.doxygen.org/index.html">
      <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.2 </li>
    </ul>
  </div>
  </body>
  </html>